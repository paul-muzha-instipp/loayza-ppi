{% extends "base.html" %}

{% block contenido %}
<div class="container my-5">
    <h2 class="mb-4 text-center">Finalizar compra</h2>

    {% if mensaje %}
        <div class="alert alert-success">{{ mensaje }}</div>
    {% endif %}

    <form method="get" class="mb-4 row g-2">
        <div class="col-auto">
            <label for="id_cedula" class="form-label">Cédula:</label>
            <input type="text" class="form-control" id="id_cedula" name="cedula" value="{{ cliente_datos.cedula|default:'' }}" required>
        </div>
        <div class="col-auto align-self-end">
            <button type="submit" class="btn btn-secondary">Buscar</button>
        </div>
    </form>

    <form method="post" class="mb-4">
        {% csrf_token %}

        <div class="row mb-3">
            <!-- <div class="col-md-4">
                <label for="cedula" class="form-label">Cédula:</label>
                <div class="input-group">
                    <input type="text" id="cedula" name="cedula" class="form-control" value="{{ cliente_datos.cedula|default:'' }}" required>
                    <button class="btn btn-secondary" type="submit" name="buscar" value="1">Buscar</button>
                </div>
            </div> -->
            <div class="col-md-4">
                <label for="cedula" class="form-label">Cédula:</label>
                <div class="input-group">
                    <input type="text" id="cedula" name="cedula" class="form-control" value="{{ cliente_datos.cedula|default:'' }}" required>
                </div>
            </div>
            <div class="col-md-4">
                <label for="nombre" class="form-label">Nombre:</label>
                <input type="text" id="nombre" name="nombre" class="form-control" value="{{ cliente_datos.nombre|default:'' }}" required>
            </div>
            <div class="col-md-4">
                <label for="direccion" class="form-label">Dirección:</label>
                <input type="text" id="direccion" name="direccion" class="form-control" value="{{ cliente_datos.direccion|default:'' }}" required>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-md-4">
                <label for="telefono" class="form-label">Teléfono:</label>
                <input type="text" id="telefono" name="telefono" class="form-control" value="{{ cliente_datos.telefono|default:'' }}" required>
            </div>
            <div class="col-md-4">
                <label for="email" class="form-label">Email:</label>
                <input type="email" id="email" name="email" class="form-control" value="{{ cliente_datos.email|default:'' }}" required>
            </div>
        </div>

        <h4>Resumen de compra:</h4>
        <div class="table-responsive">
            <table class="table table-bordered align-middle">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Precio unitario</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in productos %}
                    <tr>
                        <td>{{ item.producto.nombre }}</td>
                        <td>{{ item.cantidad }}</td>
                        <td>${{ item.producto.precio }}</td>
                        <td>${{ item.subtotal }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <h5 class="text-end">Total: ${{ total }}</h5>
        <div class="text-end mt-3">
            <button type="submit" class="btn btn-success btn-lg" id="btn-comprar">Confirmar compra</button>
            <a href="{% url 'carrito' %}" class="btn btn-outline-secondary ms-2">Volver al carrito</a>
        </div>
    </form>
</div>
{% endblock %}
